# Домашнее задание: Базы данных, репликация и масштабирование

## Задание 1: Преимущества использования масштабирования методами репликации

### 1. Активный master-сервер и пассивный репликационный slave-сервер

Основные преимущества:
1. Повышение доступности системы - при отказе master-сервера можно быстро переключиться на slave-сервер
2. Разделение нагрузки - запросы на чтение можно направлять на slave-сервер, оставляя master для операций записи
3. Безопасное резервное копирование - создание бэкапов можно выполнять на slave-сервере без остановки основной БД
4. Упрощение процесса обслуживания - можно выполнять технические работы на slave, пока master продолжает работу
5. Географическое распределение - slave можно разместить в другом дата-центре для повышения надежности

### 2. Master-сервер и несколько slave-серверов

Основные преимущества:
1. Масштабируемость операций чтения - нагрузку на чтение можно распределить между несколькими slave-серверами
2. Повышенная отказоустойчивость - при выходе из строя одного slave остальные продолжают работу
3. Географическое распределение - slave-серверы можно размещать в разных регионах для уменьшения задержек
4. Специализация slave-серверов - разные slave можно использовать для разных задач (аналитика, отчетность, обслуживание трафика)
5. Улучшенная производительность при пиковых нагрузках - можно временно добавлять дополнительные slave-серверы
6. Гибкость в обслуживании - можно выводить slave-серверы на обслуживание поочередно

Сравнение подходов:
- Первая схема проще в реализации и обслуживании, подходит для небольших и средних проектов
- Вторая схема обеспечивает лучшую масштабируемость и отказоустойчивость, но сложнее в настройке и дороже

## Задание 2: План горизонтального и вертикального шардинга БД

Структура таблиц:
- Пользователи: id, email, имя, пароль, телефон, город, страна
- Книги: id, название, автор, жанр, цена, описание
- Магазины: id, название, адрес, регион, менеджер_id

Блок-схема архитектуры:

[Клиентское приложение]
        |
[Шард-контроллер]
        |
---------------------------------
|          |          |         |
[Шард 1]  [Шард 2]  [Шард 3]  [Вертикальные]
         |          |          |    шарды
   [Slave]    [Slave]    [Slave]    (приватные
                                    данные)

Горизонтальный шардинг (разделение по строкам):

Шард 1: Пользователи с id % 3 = 0
Шард 2: Пользователи с id % 3 = 1
Шард 3: Пользователи с id % 3 = 2

Вертикальный шардинг (разделение по столбцам):

Основные серверы каждого шарда содержат:
- users_public: id, email, имя, город, страна
- books_public: id, название, автор, жанр, цена
- shops_public: id, название, адрес, регион

Вертикальные шарды содержат:
- users_private: id, пароль, телефон, история_покупок
- books_details: id, описание, отзывы, рейтинг
- shops_finance: id, выручка, количество_продаж, расходы

Режимы работы серверов:

1. Шард-контроллер
   - Режим: активный
   - Назначение: определяет целевой шард для каждого запроса
   - Пример: пользователь id=10 → 10%3=1 → Шард 2

2. Основные шарды (1, 2, 3)
   - Каждый шард имеет Master-сервер для операций записи
   - Каждый шард имеет Slave-сервер для операций чтения и резервирования
   - Master и Slave работают в режиме репликации

3. Вертикальные шарды
   - Отдельные защищенные серверы для конфиденциальных данных
   - Режим: активный с ограниченным доступом
   - Каждый вертикальный шард привязан к своему горизонтальному шарду

Пример работы системы:

1. Пользователь с id=7 выполняет вход в систему
2. Шард-контроллер получает запрос
3. Контроллер вычисляет: 7 % 3 = 1 → направляет в Шард 2
4. Запрос на аутентификацию идет на Master Шарда 2
5. Master проверяет публичные данные на основном сервере
6. Для проверки пароля запрос идет на вертикальный шард Шарда 2
7. Ответ возвращается пользователю

Преимущества архитектуры:

1. Равномерное распределение нагрузки между шардами
2. Безопасное хранение конфиденциальных данных
3. Возможность независимого масштабирования каждого шарда
4. Улучшенная производительность за счет разделения чтения и записи
5. Соответствие требованиям защиты персональных данных
6. Простота добавления новых шардов при росте нагрузки

Технологии для реализации:

- База данных: PostgreSQL или MySQL
- Шардинг: Citus для PostgreSQL или Vitess для MySQL
- Балансировщик: HAProxy
- Репликация: встроенные механизмы СУБД
